---
title: "leaflet"
author: "Maggie Klope"
date: "1/5/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

# # install packages if you have not already
# install.packages("tidyverse")
# install.packages("leaflet")
# install.packages("leaflet.minicharts")
# install.packages("sf")

library(tidyverse)
library(leaflet)
library(leaflet.minicharts)
library(sf)

```

## Leaflet: Easily create interactive maps

- Uses the Leaflet open-source JavaScript library
- Interactive zoom
- Can be embedded into R Markdown and Shiny apps
- Compatible with a lot of data types (dataframes with lat/long columns, sp and sf package spatial objects)


### Basic Map with one point
```{r}

# using lat/long for the CA Capitol
ca_capitol <- leaflet() %>% #using the '%>%' pipe from tidyverse
  addTiles() %>% #loads default baselayer map
  addMarkers(lat = 38.576572, lng = -121.4930107, popup = "CA State Capitol") #popup will add a small window that aappear over the point

# adding more features
ca_capitol %>% 
  addProviderTiles(providers$Esri.WorldStreetMap) %>% #changes basemap
  addMiniMap() %>% #add in a second zoomed out map %>% 
  addScaleBar()
  
```

### Using shapefile

```{r}

# use sf to read the shapefile
birds <- st_read("ds78.shp") %>% 
  filter(LONGITUDE != 0.0000) %>%  # removing a few data points that were missing lat/long
  filter(REGION == "Southwest")

# creating a point map
bird_map <- leaflet(data = birds) %>% 
  addTiles() %>% 
  addMarkers(lat = birds$LATITUDE, lng = birds$LONGITUDE)

```

### Lots of different backgrounds maps you can use with addProviderTiles()

add link here

```{r}
# from more informative
bird_map %>% addProviderTiles(providers$Esri.WorldImagery)

# to more artistic
bird_map %>% addProviderTiles(providers$Stamen.Watercolor)

# to more... metal
bird_map %>% addProviderTiles(providers$Thunderforest.SpinalMap) # not working

```

### Creating a cluster map
```{r}
leaflet(data = birds) %>%
  addTiles() %>%
  addMarkers(lat = birds$LATITUDE, lng = birds$LONGITUDE,
  clusterOptions = markerClusterOptions()
)

```

### Creating custom icons
```{r}
# making a dataset for locations where brown pelicans (BRPN) were detected
pelicans <- birds %>% 
  filter(BRPN == "Y") # filtering where the BRPN column has a "Y" for yes

# using the makeIcon() function to load a .png file
pelican_icon <- makeIcon(iconUrl = "pelican.png", iconHeight = 20, iconWidth = 20)

leaflet(data = pelicans) %>% 
  addTiles() %>% 
  addMarkers(lat = pelicans$LATITUDE, 
             lng = pelicans$LONGITUDE, 
             icon = pelican_icon) # setting the icon argument to the png that we loaded
  
```

### Using the leaflet.minicharts package, you can add figures over your map
```{r}
bird_matrix <- as.tibble(birds)

leaflet(data = bird_matrix) %>% 
  addTiles() %>% 
  addMinicharts(
    lng = bird_matrix$LONGITUDE,
    lat = bird_matrix$LATITUDE,
    type = "bar",
    chartdata = bird_matrix[, c("SCORE", "THREAT")])

leaflet(data = bird_matrix) %>% 
  addTiles() %>% 
  addMinicharts(
    lng = bird_matrix$LONGITUDE,
    lat = bird_matrix$LATITUDE,
    type = "pie",
    chartdata = bird_matrix[, c("SCORE", "THREAT")])

leaflet(data = bird_matrix) %>% 
  addTiles() %>% 
  addMinicharts(
    lng = bird_matrix$LONGITUDE,
    lat = bird_matrix$LATITUDE,
    showLabels = TRUE,
    chartdata = bird_matrix$SCORE)

```

### Maps with Polylines

```{r}

# loading example dataset from the leaflet package
storm_data <- atlStorms2005

# Create a continuous palette function
palette <- colorNumeric(
  palette = "Reds",
  domain = storm_data$MaxWind)

storm <- leaflet(storm_data) %>% 
  addTiles() %>% 
  # addPolylines(color = "red") %>% 
  addPolylines(color = ~palette(MaxWind), opacity = .5) %>% 
  addLegend(pal = palette, values = ~MaxWind, 
            title = "Maximum Wind", 
            opacity = .5)

storm

# some extra features
storm %>% 
  addGraticule() %>% 
  addTerminator()
```

### Compatible with Shiny

- See the leaflet_shiny_app.R file
